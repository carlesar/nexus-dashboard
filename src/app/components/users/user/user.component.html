<mat-card *ngIf="user">
  <h2 style="margin: 0;">User: {{ user.User }}</h2>

  <mat-card-content *ngIf="user">
    <div class="mat-table" role="grid">
      <div class="mat-row" role="row">
        <div class="mat-header-cell cdk-column-username mat-column-username" role="columnheader" style="flex: 4;">
          Username
        </div>
        <div class="mat-header-cell cdk-column-maxSessions mat-column-maxSessions" role="columnheader">
          Max Sessions
        </div>
        <div class="mat-header-cell cdk-column-maxSessions mat-column-maxSessions" role="columnheader">
          Actual Sessions
        </div>
        <div class="mat-header-cell cdk-column-enabled mat-column-enabled" role="columnheader">
          Enabled
        </div>
      </div>

      <div class="mat-row" role="row">
        <div class="mat-cell cdk-column-username mat-column-username" role="gridcell" style="flex: 4;">
          {{ user.User }}
        </div>
        <div class="mat-cell cdk-column-maxSessions mat-column-maxSessions" role="gridcell">
          {{ user.MaxSessions }}
        </div>
        <div class="mat-cell cdk-column-maxSessions mat-column-maxSessions" role="gridcell">
          <span *ngIf="sessions">{{ sessions.N }}</span>
          <span *ngIf="!sessions">0</span>
        </div>
        <div class="mat-cell cdk-column-enabled mat-column-enabled" role="gridcell">
          <button mat-icon-button (click)="toggleDisabled()">
            <mat-icon *ngIf="!user.Disabled">check_circle</mat-icon>
            <mat-icon *ngIf="user.Disabled">cancel</mat-icon>
          </button>
        </div>
      </div>
    </div>


    <mat-tab-group>
      <mat-tab label="Tags">
        <div style="display: flex; flex-wrap: wrap;">
          <pre style="flex: 1;">{{ this.tags }}</pre>
          <div style="flex: 1;">
            <mat-list>
              <div *ngFor="let key of user.Tags | keys">
                <h2 mat-subheader>Tags on path: "{{ key }}"</h2>
                <mat-list-item *ngFor="let value of user.Tags[key] | keys">
                  <button mat-icon-button (click)="deleteTag(key, value)">
                    <mat-icon mat-list-icon>delete</mat-icon>
                  </button>

                  <p>{{ value }}: {{ format(user.Tags[key][value]) }}</p>
                </mat-list-item>
              </div>
            </mat-list>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Expanded tags">
        <pre>{{ this.effectivetags }}</pre>
      </mat-tab>

      <mat-tab label="Templates">
        <mat-list>
          <mat-list-item *ngFor="let template of user.Templates">
            <button mat-icon-button [routerLink]="'/users/' + template">
              <mat-icon mat-list-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button (click)="deleteTemplate(template)">
              <mat-icon mat-list-icon>delete</mat-icon>
            </button>
            <p>{{ template }}</p>
          </mat-list-item>
          <mat-list-item style="margin-top: 20px;">
            <form [formGroup]="formTemplate">
              <button mat-icon-button [disabled]="!formTemplate.valid" (click)="addTemplate()">
                <mat-icon mat-list-icon>add</mat-icon>
              </button>

              <mat-form-field>
                <input matInput placeholder="New template" formControlName="template">
              </mat-form-field>
            </form>
          </mat-list-item>
        </mat-list>
      </mat-tab>

      <mat-tab label="White list">
        <mat-list>
          <mat-list-item *ngFor="let ip of user.Whitelist">
            <button mat-icon-button (click)="deleteWhitelist(ip)">
              <mat-icon mat-list-icon>delete</mat-icon>
            </button>
            <p>{{ ip }}</p>
          </mat-list-item>
          <mat-list-item style="margin-top: 20px;">
            <form [formGroup]="formWhitelist">
              <button mat-icon-button [disabled]="!formWhitelist.valid" (click)="addWhitelist()">
                <mat-icon mat-list-icon>add</mat-icon>
              </button>

              <mat-form-field>
                <input matInput placeholder="New white list IP" formControlName="ip">
              </mat-form-field>
            </form>
          </mat-list-item>
        </mat-list>
      </mat-tab>

      <mat-tab label="Black list">
        <mat-list>
          <mat-list-item *ngFor="let ip of user.Blacklist">
            <button mat-icon-button (click)="deleteBlacklist(ip)">
              <mat-icon mat-list-icon>delete</mat-icon>
            </button>
            <p>{{ ip }}</p>
          </mat-list-item>
          <mat-list-item style="margin-top: 20px;">
            <form [formGroup]="formBlacklist">
              <button mat-icon-button [disabled]="!formBlacklist.valid" (click)="addBlacklist()">
                <mat-icon mat-list-icon>add</mat-icon>
              </button>

              <mat-form-field>
                <input matInput placeholder="New black list IP" formControlName="ip">
              </mat-form-field>
            </form>
          </mat-list-item>
        </mat-list>
      </mat-tab>

      <mat-tab label="Edit">Edit</mat-tab>
    </mat-tab-group>

  </mat-card-content>
</mat-card>

<mat-card *ngIf="!user">
  <p>User does not exist</p>
</mat-card>